{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		 "apiVersionDeployments": {
			 "type": "string",
			 "minLength": 1,
			 "metadata": {
				 "description": "Compute API Version"
			 }
		 },
		 "targetVMName":{
			 "type": "string",
			 "minLength": 1,
			 "metadata": {
				 "description": "Name of the vm to run the extension on"
			 }
		 }
	},
	"variables": {  
	    "initScriptUrl": "https://raw.githubusercontent.com/JeremyWx/aks-engine/master/extensions/gmsa-dc/v1/Promote-DC.ps1"
		},
	"resources": [
	 {
	   "apiVersion": "[parameters('apiVersionDeployments')]",
	   "dependsOn": [],
	   "location": "[resourceGroup().location]",
	   "type": "Microsoft.Compute/virtualMachines/extensions",
	   "name": "[concat(parameters('targetVMName'),'/gmsa-dc-cse')]",
	   "properties": {
		 "publisher": "Microsoft.Compute",
		 "type": "CustomScriptExtension",
		 "typeHandlerVersion": "1.8",
		 "autoUpgradeMinorVersion": true,
		 "settings": {
			 "fileUris": [
				 "[variables('initScriptUrl')]"
			  ]
		 },
		 "protectedSettings": {
			 "commandToExecute": "[concat('powershell.exe -ExecutionPolicy Unrestricted ./Promote-DC.ps1')]"
		 }
	   }
	 }
	 ],
	"outputs": {  }
 }